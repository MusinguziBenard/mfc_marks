<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fun Learning Hub — Emoji & Voice (One File)</title>
<style>
:root{--bg:#f7fbff;--ink:#111827;--brand:#ff6b35;--accent:#6c8cff;--ok:#16a34a;--bad:#ef4444;--panel:#fffdf2;--chip:#87cefa;--chip-sel:#ffd700}
*{box-sizing:border-box}
html,body{height:100%;margin:;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:var(--ink);background:var(--bg);overflow:hidden}
.wrap{display:grid;grid-template-rows:auto 1fr auto;height:100vh}
header{background:linear-gradient(90deg,#fff,#fff2ea);box-shadow:0 6px 18px rgba(0,0,0,.06)}
.top{max-width:1100px;margin: auto;padding:10px;display:flex;align-items:center;gap:12px}
.brand{display:flex;align-items:center;gap:10px}
.brand h1{font-size:1.1rem;color:var(--brand);margin:0}
.controls-right{margin-left:auto;display:flex;align-items:center;gap:8px}
.pill{background:#fff;padding:8px 10px;border-radius:999px;border:1px solid #f0f0f0;display:inline-flex;align-items:center;gap:8px}
.meter{height:10px;background:#fff;border-radius:999px;overflow:hidden;border:2px solid #ffe6d0;flex:1}
.meter>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#ffb703,#ffd166);transition:width .35s}

main{max-width:1100px;margin:10px auto;padding:10px;height:calc(100vh - 170px);display:grid;grid-template-rows:1fr auto;gap:10px}
.hub{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;height:100%}
.card{background:var(--panel);border-radius:14px;padding:12px;box-shadow:0 10px 24px rgba(0,0,0,.06);display:flex;flex-direction:column}
.card h2{margin:0 0 8px;color:#ff4d00;font-size:1rem}
.centered{display:flex;align-items:center;justify-content:center}
.picture{flex:1;border-radius:12px;border:3px dashed #ffd6f2;background:#fff;display:flex;align-items:center;justify-content:center;font-size:4.8rem}
.hint{margin-top:8px;font-size:.95rem;color:#374151;min-height:1.2em}
.drop{flex:1;border-radius:12px;border:3px dashed #ffd6f2;background:#fff;padding:10px;display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap;font-size:2.2rem}
.choices{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;padding:8px;background:#fff;border-radius:10px}
.chip{display:inline-flex;align-items:center;justify-content:center;background:var(--chip);border-radius:12px;padding:10px 14px;font-size:1.9rem;cursor:pointer;user-select:none;transition:transform .12s,background .12s}
.chip:active{transform:scale(.96)}
.chip.selected{background:var(--chip-sel);transform:scale(1.06)}
.drop.ok{animation:pop .5s;box-shadow:inset 0 0 0 4px rgba(22,163,74,.12)}
.drop.bad{animation:shake .4s;box-shadow:inset 0 0 0 4px rgba(239,68,68,.12)}
@keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}

.mode-tabs{display:flex;gap:6px}
.tab{background:#fff;padding:8px 10px;border-radius:999px;border:2px solid #f1f5f9;cursor:pointer}
.tab.active{background:linear-gradient(90deg,#fff7ef,#fff2f0);border-color:#ffd2b3}

.bottom-row{display:flex;gap:8px;justify-content:center;padding:8px}
.btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;background:var(--accent);color:#fff;cursor:pointer;font-weight:600;box-shadow:0 10px 20px rgba(108,140,255,.12)}
.btn.ghost{background:#fff;color:#111;border:1px solid #e6e7eb;box-shadow:none}
.small{padding:8px 10px;font-size:.95rem}

footer{padding:8px;text-align:center;color:#6b7280}
canvas#confetti{position:fixed;inset:0;pointer-events:none;z-index:9999}

/* responsive: stack on small */
@media (max-width:980px){.hub{grid-template-columns:1fr 1fr;grid-auto-rows:1fr}.picture{font-size:3.6rem}.chip{font-size:1.6rem;padding:8px 12px}}
@media (max-width:560px){.hub{grid-template-columns:1fr}.picture{font-size:3.2rem}}
</style>
</head>
<body>
<canvas id="confetti"></canvas>
<div class="wrap">
  <header>
    <div class="top">
      <div class="brand">
        <div style="font-size:1.5rem">🌈</div>
        <h1>Fun Learning Hub</h1>
      </div>
      <div class="meter" aria-label="Progress"><i id="progressFill"></i></div>
      <div class="controls-right">
        <div class="pill">⭐ <b id="stars">0</b></div>
        <div class="pill">✅ <b id="correct">0</b></div>
        <div class="pill">🔁 <small id="modeLabel">Words</small></div>
        <button id="mic" class="pill" title="Tap to speak">🎙️ <span id="micLabel">Speak</span></button>
        <button id="mute" class="pill">🔊 On</button>
      </div>
    </div>
  </header>

  <main>
    <div class="hub">
      <!-- Word Builder -->
      <section id="panelWords" class="card">
        <h2>🔤 Word Builder</h2>
        <div class="picture" id="wordEmoji">🐱</div>
        <div class="hint" id="wordHint"></div>
        <div style="margin-top:12px" class="drop" id="wordDrop" aria-label="drop letters here"></div>
        <div style="margin-top:10px" class="choices" id="letterChoices"></div>
      </section>

      <!-- Sentence Builder -->
      <section id="panelSentences" class="card">
        <h2>🧩 Sentence Builder</h2>
        <div class="picture centered" id="sentEmoji">🧠</div>
        <div class="hint" id="sentHint"></div>
        <div style="margin-top:10px" class="drop" id="sentDrop" aria-label="drop words here"></div>
        <div style="margin-top:10px" class="choices" id="wordChoices"></div>
      </section>

      <!-- Quick Playground / Placeholder for Math/Science/SST -->
      <section id="panelPlay" class="card">
        <h2>🎯 Play & Hub</h2>
        <div class="hint">Switch modes (Words / Sentences / Math / Science / SST) — the engine is modular and emoji-first.</div>
        <div style="margin-top:12px;display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
          <button class="tab active" data-mode="words">📖 Words</button>
          <button class="tab" data-mode="sentences">✍️ Sentences</button>
          <button class="tab" data-mode="math">➕ Math</button>
          <button class="tab" data-mode="science">🔬 Science</button>
          <button class="tab" data-mode="sst">🌍 SST</button>
          <button class="tab" data-mode="tutor">🤖 Tutor</button>
        </div>

        <div style="margin-top:12px" id="playArea"></div>
      </section>
    </div>

    <div class="bottom-row">
      <button id="repeat" class="btn ghost small">🔁 Repeat</button>
      <button id="hintBtn" class="btn ghost small">💡 Hint</button>
      <button id="check" class="btn small">✅ Check</button>
      <button id="next" class="btn small">⏭️ Next</button>
    </div>
  </main>

  <footer>
    Massive encouragement mode ON — we solve together! 🌟
  </footer>
</div>

<script>
/* ======= Content (Emoji-first, modular) ======= */
const CONTENT = {
  literacy: {
    words: [
      { clue:'🐱', answer:'CAT', hint:'A furry pet that says meow'},
      { clue:'🐶', answer:'DOG', hint:'A loyal friend that barks'},
      { clue:'🍎', answer:'APPLE', hint:'A fruit that can be red or green'},
      { clue:'🚗', answer:'CAR', hint:'Goes vroom on the road'},
      { clue:'🌞', answer:'SUN', hint:'Shines bright in the sky'},
      { clue:'📖', answer:'BOOK', hint:'Full of stories'}
    ],
    sentences:[
      { clue:'I ❤️', parts:['I','love','reading'], answer:'I love reading', hint:'How you feel about books'},
      { clue:'He 🏃‍♂️', parts:['He','likes','to','run'], answer:'He likes to run', hint:'About moving fast'},
      { clue:'We 🍎', parts:['We','like','apples'], answer:'We like apples', hint:'A sentence about fruit'}
    ]
  },
  math: {
    exercises:[
      { clue:'🍎 + 🍎 = ?', answer:'2', hint:'Two apples'},
      { clue:'3️⃣ + 2️⃣ = ?', answer:'5', hint:'Add three and two'}
    ]
  },
  science:{
    q:[{ clue:'Which lives in water?', options:['🐟','🐕','🐦'], answer:'🐟', hint:'Fish live in water'}]
  },
  sst:{
    q:[{ clue:'Which is a globe?', options:['🗺️','🏠','🚗'], answer:'🗺️', hint:'A map or globe shows the world'}]
  }
};

/* ======= State ======= */
const state = { mode:'words', mute:false, stars:0, correct:0, idx:{words:0,sentences:0,math:0,science:0,sst:0}, tutor:false };

/* ======= Utils ======= */
const $ = id => document.getElementById(id);
const pick = arr => arr[Math.floor(Math.random()*arr.length)];
const shuffle = arr => arr.slice().sort(()=>Math.random()-.5);
const removeEmoji = s => s && s.replace(/[\p{Extended_Pictographic}\u{FE0F}]/gu,'');

function save(){ try{ localStorage.setItem('fl_hub', JSON.stringify({stars:state.stars,correct:state.correct,idx:state.idx})); }catch(e){} }
function load(){ try{ const r=JSON.parse(localStorage.getItem('fl_hub')||'{}'); if(r.stars) state.stars=r.stars; if(r.correct) state.correct=r.correct; if(r.idx) state.idx=r.idx;}catch(e){} }

/* ======= TTS & Sound ======= */
const synth = window.speechSynthesis;
function speak(txt, opts={rate:0.95,pitch:1.05}){
  if(state.mute) return;
  if(!('speechSynthesis' in window)) return;
  const u=new SpeechSynthesisUtterance(removeEmoji(txt)); u.rate=opts.rate; u.pitch=opts.pitch; synth.cancel(); synth.speak(u);
}
function tone(){ if(state.mute) return; try{ const ac=new(window.AudioContext||window.webkitAudioContext)(); const o=ac.createOscillator(); const g=ac.createGain(); o.type='sine'; o.frequency.value=880; g.gain.value=0.0001; g.gain.exponentialRampToValueAtTime(0.2, ac.currentTime+0.01); o.connect(g).connect(ac.destination); o.start(); o.frequency.exponentialRampToValueAtTime(1320, ac.currentTime+.18); g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+.4); o.stop(ac.currentTime+.4);}catch(e){}
}

/* ======= Confetti ======= */
function confetti(ms=1200){ const c=$('confetti'); const ctx=c.getContext('2d'); const dpr=Math.max(1,devicePixelRatio||1); c.width=innerWidth*dpr; c.height=innerHeight*dpr; ctx.scale(dpr,dpr); const N=220, parts=[]; for(let i=0;i<N;i++) parts.push({x:Math.random()*innerWidth,y:-Math.random()*innerHeight,r:Math.random()*7+3,c:`hsl(${Math.random()*360},100%,50%)`,vy:2+Math.random()*4}); let t=0, stop=ms/16; (function draw(){ ctx.clearRect(0,0,innerWidth,innerHeight); for(const p of parts){ ctx.fillStyle=p.c; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); p.y+=p.vy; if(p.y>innerHeight) p.y=-p.r; } if(t++<stop) requestAnimationFrame(draw); else ctx.clearRect(0,0,innerWidth,innerHeight); })(); }

/* ======= HUD ======= */
function updateHud(){ $('stars').textContent = state.stars; $('correct').textContent = state.correct; $('progressFill').style.width = Math.min(100,(state.correct%5)*20)+'%'; $('modeLabel').textContent = state.mode.charAt(0).toUpperCase()+state.mode.slice(1); }

/* ======= Word Builder ======= */
function loadWord(){ const list = CONTENT.literacy.words; const idx = state.idx.words % list.length; const item = list[idx]; $('wordEmoji').textContent = item.clue; $('wordHint').textContent = item.hint; $('wordDrop').innerHTML=''; const letters = shuffle(item.answer.split('')); const choices=$('letterChoices'); choices.innerHTML=''; letters.forEach(ch=>{ const d=document.createElement('div'); d.className='chip'; d.textContent=ch; d.onclick=()=>{ d.classList.add('selected'); setTimeout(()=>d.classList.remove('selected'),180); $('wordDrop').appendChild(d); speak(ch); }; choices.appendChild(d); }); $('wordDrop').onclick = e=>{ if(e.target.classList.contains('chip') && e.target.parentNode==$('wordDrop')){ $('letterChoices').appendChild(e.target); speak('remove'); } } }

function checkWord(){ const item = CONTENT.literacy.words[state.idx.words % CONTENT.literacy.words.length]; const formed = [...$('wordDrop').children].map(n=>n.textContent).join(''); if(formed.toUpperCase()===item.answer.toUpperCase()){ successFlow(item.answer); state.idx.words++; } else { failFlow(formed); } save(); updateHud(); }

/* ======= Sentence Builder ======= */
function loadSentence(){ const list=CONTENT.literacy.sentences; const idx = state.idx.sentences % list.length; const item = list[idx]; $('sentEmoji').textContent = item.clue; $('sentHint').textContent = item.hint || '' ; $('sentDrop').innerHTML=''; const words = shuffle(item.parts); const choices=$('wordChoices'); choices.innerHTML=''; words.forEach(w=>{ const d=document.createElement('div'); d.className='chip'; d.textContent=w; d.onclick=()=>{ d.classList.add('selected'); setTimeout(()=>d.classList.remove('selected'),180); $('sentDrop').appendChild(d); speak(w); }; choices.appendChild(d); }); $('sentDrop').onclick=e=>{ if(e.target.classList.contains('chip') && e.target.parentNode==$('sentDrop')){ $('wordChoices').appendChild(e.target); speak('remove'); } } }
function checkSentence(){ const item=CONTENT.literacy.sentences[state.idx.sentences % CONTENT.literacy.sentences.length]; const formed = [...$('sentDrop').children].map(n=>n.textContent).join(' '); if(formed===item.answer){ successFlow(item.answer); state.idx.sentences++; } else { failFlow(formed); } save(); updateHud(); }

/* ======= Generic success/fail ======= */
function successFlow(answer){ $('wordDrop').classList.remove('bad'); $('sentDrop').classList.remove('bad'); $('wordDrop').classList.add('ok'); $('sentDrop').classList.add('ok'); const praises = ['Brilliant!','Fantastic!','You did it!','Amazing!','Super!']; const msg = pick(praises); state.stars++; state.correct++; speak(`${msg} ${answer}. Great teamwork!`); tone(); confetti(900); setTimeout(()=>{ $('wordDrop').classList.remove('ok'); $('sentDrop').classList.remove('ok'); },700); }
function failFlow(formed){ const msg = formed? `I heard: ${formed}.` : 'No answer yet.'; speak(`${msg} Almost there! Let\'s try together.`); $('wordDrop').classList.add('bad'); $('sentDrop').classList.add('bad'); setTimeout(()=>{ $('wordDrop').classList.remove('bad'); $('sentDrop').classList.remove('bad'); },550); }

/* ======= Hint logic (costs a star) ======= */
function giveHint(){ if(state.stars<=0){ speak('Earn a star first to get a hint. You can do it!'); return; } state.stars--; if(state.mode==='words'){ const item = CONTENT.literacy.words[state.idx.words % CONTENT.literacy.words.length]; const built = [...$('wordDrop').children].map(n=>n.textContent).join(''); if(built.length < item.answer.length){ const next = item.answer[built.length]; const chip=[...$('letterChoices').children].find(c=>c.textContent.toUpperCase()===next.toUpperCase()); if(chip) { $('wordDrop').appendChild(chip); chip.classList.add('selected'); setTimeout(()=>chip.classList.remove('selected'),220); speak(next); } } }
else if(state.mode==='sentences'){ const item = CONTENT.literacy.sentences[state.idx.sentences % CONTENT.literacy.sentences.length]; const built = [...$('sentDrop').children].map(n=>n.textContent); if(built.length < item.parts.length){ const next = item.parts[built.length]; const chip=[...$('wordChoices').children].find(c=>c.textContent===next); if(chip){ $('sentDrop').appendChild(chip); chip.classList.add('selected'); setTimeout(()=>chip.classList.remove('selected'),220); speak(next); } } }
updateHud(); save(); }

/* ======= Mode switching & UI wiring ======= */
function setMode(m){ state.mode=m; document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active', t.dataset.mode===m)); if(m==='words'){ $('panelWords').style.display='flex'; $('panelSentences').style.display='none'; } else if(m==='sentences'){ $('panelWords').style.display='none'; $('panelSentences').style.display='flex'; } else { $('panelWords').style.display='none'; $('panelSentences').style.display='none'; }
$('modeLabel').textContent = m.charAt(0).toUpperCase()+m.slice(1); updateHud(); if(m==='words') loadWord(); if(m==='sentences') loadSentence(); /* placeholders for other modes */ }

document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>setMode(t.dataset.mode)));

/* ======= Voice recognition (robust handling) ======= */
const SR = window.SpeechRecognition || window.webkitSpeechRecognition || null;
let recog = null; let listening = false; let lastTranscript = '';
function initRecog(){ if(!SR) return null; if(recog) return recog; try{ recog = new SR(); recog.continuous = false; recog.interimResults = false; recog.lang = 'en-US'; recog.maxAlternatives = 4; recog.onstart = ()=>{ listening=true; $('micLabel').textContent='Listening...'; $('mic').style.background='#fff3cd'; }; recog.onend = ()=>{ listening=false; $('micLabel').textContent='Speak'; $('mic').style.background=''; }; recog.onerror = e=>{ listening=false; $('micLabel').textContent='Speak'; $('mic').style.background=''; console.warn('Recognition error', e); }; recog.onresult = e=>{ const res = e.results[0]; const transcripts = []; for(let i=0;i<res.length;i++) transcripts.push(res[i].transcript.trim()); lastTranscript = transcripts[0]; handleSpeechResult(transcripts); }; return recog;}catch(err){ return null;} }

function startListening(){ const r = initRecog(); if(!r){ alert('Speech recognition not supported on this browser. Use Chrome or Edge on desktop or Android for full voice features.'); return; } try{ r.start(); }catch(e){} }

function handleSpeechResult(list){ const t = (list[0]||'').toLowerCase(); // best guess
  // simple routing: if tutor active, engage in co-solve; otherwise evaluate
  if(state.tutor){ tutorHandle(t); return; }
  if(state.mode==='words'){ const target = CONTENT.literacy.words[state.idx.words % CONTENT.literacy.words.length].answer.toLowerCase(); if(t===target || t.replace(/[^a-z]/g,'')===target){ successFlow(target); state.idx.words++; } else { // try close match
      // check if transcript contains target as a word or letters spelled
      if(t.includes(target)) { successFlow(target); state.idx.words++; } else { speak(`I heard ${t}. Let's try again together. Repeat after me: ${target}`); } }
  } else if(state.mode==='sentences'){ const target = CONTENT.literacy.sentences[state.idx.sentences % CONTENT.literacy.sentences.length].answer.toLowerCase(); if(t===target || t.replace(/[^a-z ]/g,'')===target){ successFlow(target); state.idx.sentences++; } else { speak(`I heard ${t}. Let's try saying it together: ${target}`); } }
  updateHud(); save(); }

/* ======= Tutor co-solve (simple guided interaction) ======= */
let tutorStep=0;
function startTutor(){ state.tutor=true; speak('Hello friend! I will guide you step by step. Say ready when you are.'); }
function stopTutor(){ state.tutor=false; tutorStep=0; speak('Tutor off. Great work!'); }
function tutorHandle(transcript){ const t = transcript.toLowerCase(); if(t.includes('ready')||t.includes('yes')||t.includes('i am ready')){ tutorStep=1; speak('Awesome — repeat after me: C'); startListening(); } else if(tutorStep===1){ // expecting letter
    // we accept any single-letter utterance; proceed to next
    tutorStep=2; speak('Great! Now say A'); startListening(); } else if(tutorStep===2){ tutorStep=3; speak('Wonderful! Now say T'); startListening(); } else if(tutorStep===3){ speak('Perfect! You spelled CAT. High five!'); state.stars++; state.correct++; save(); updateHud(); tutorStep=0; state.tutor=false; } else { speak('Say ready when you are!'); }
}

/* ======= Event wiring ======= */
$('check').addEventListener('click', ()=>{ if(state.mode==='words') checkWord(); else if(state.mode==='sentences') checkSentence(); });
$('hintBtn').addEventListener('click', giveHint);
$('next').addEventListener('click', ()=>{ if(state.mode==='words'){ state.idx.words++; loadWord(); } else if(state.mode==='sentences'){ state.idx.sentences++; loadSentence(); } updateHud(); save(); });
$('repeat').addEventListener('click', ()=>{ if(state.mode==='words'){ const it = CONTENT.literacy.words[state.idx.words % CONTENT.literacy.words.length]; speak(it.clue + '. ' + it.hint); } else if(state.mode==='sentences'){ const it = CONTENT.literacy.sentences[state.idx.sentences % CONTENT.literacy.sentences.length]; speak(it.clue + '. ' + (it.hint||'')); } });
$('mic').addEventListener('click', ()=>{ // toggle listening for a single phrase
  if(listening){ if(recog) recog.stop(); return; } startListening(); });
$('mute').addEventListener('click', ()=>{ state.mute=!state.mute; $('mute').textContent = state.mute? '🔇 Off':'🔊 On'; });

/* tabs */
document.querySelectorAll('.tab').forEach(tb=>tb.addEventListener('click', e=>{ setMode(tb.dataset.mode); if(tb.dataset.mode==='tutor'){ startTutor(); } else { state.tutor=false; tutorStep=0;} }));

/* Initialize */
load(); setMode('words'); updateHud();

// try to init speech recognition early (but don't start)
initRecog();

</script>
</body>
</html>

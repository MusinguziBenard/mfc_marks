<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather and Location App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            padding: 20px;
        }
        h1 {
            color: #ff9800;
        }
        .weather-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #e0f7fa;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Weather and Location App</h1>
    
    <div class="location">
        <h2>Your Location</h2>
        <p id="location-info">Fetching location...</p>
    </div>
    
    <div class="weather-info">
        <h2>Current Weather</h2>
        <p id="current-weather">Loading...</p>
    </div>
    
    <div class="weather-info">
        <h2>5-Day Forecast</h2>
        <p id="forecast">Loading...</p>
    </div>

    <script>
        const weatherApiKey = '74037a84a785450abf9190335241409';
        const weatherApiUrl = 'https://api.openweathermap.org/data/2.5';
        const nominatimApiUrl = 'https://nominatim.openstreetmap.org/reverse';

        let villageName = '';
        let fullLocation = '';

        function getGeoLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        fetchFullLocation(lat, lon);
                    },
                    (error) => {
                        document.getElementById('location-info').innerText = "Failed to retrieve location.";
                        document.getElementById('location-info').classList.add('error');
                    }
                );
            } else {
                document.getElementById('location-info').innerText = "Geolocation is not supported by your browser.";
                document.getElementById('location-info').classList.add('error');
            }
        }

        function fetchFullLocation(lat, lon) {
            const reverseGeocodeUrl = `${nominatimApiUrl}?lat=${lat}&lon=${lon}&format=json&accept-language=en`;

            fetch(reverseGeocodeUrl)
                .then(response => response.json())
                .then(data => {
                    // Construct full location from available data
                    const village = data.address.village || '';
                    const town = data.address.town || '';
                    const city = data.address.city || '';
                    const state = data.address.state || '';
                    const country = data.address.country || '';
                    
                    villageName = village || town || city || 'Unknown';
                    fullLocation = `${village ? village + ', ' : ''}${town ? town + ', ' : ''}${city ? city + ', ' : ''}${state ? state + ', ' : ''}${country}`;

                    document.getElementById('location-info').innerText = `You are at: ${fullLocation}`;
                    fetchWeatherData(villageName, country);
                })
                .catch(() => {
                    document.getElementById('location-info').innerText = "Failed to retrieve location.";
                    document.getElementById('location-info').classList.add('error');
                });
        }

        function fetchWeatherData(villageName, country) {
            const locationQuery = `${villageName},${country}`;
            const currentWeatherUrl = `${weatherApiUrl}/weather?q=${locationQuery}&appid=${weatherApiKey}&units=metric`;
            const forecastWeatherUrl = `${weatherApiUrl}/forecast?q=${locationQuery}&appid=${weatherApiKey}&units=metric`;

            // Fetch current weather
            fetch(currentWeatherUrl)
                .then(response => response.json())
                .then(data => {
                    if (data && data.weather) {
                        const description = data.weather[0].description;
                        const temp = data.main.temp;
                        document.getElementById('current-weather').innerText = `Weather: ${description}, Temperature: ${temp}°C`;
                        changeBackground(data.weather[0].main);
                    } else {
                        document.getElementById('current-weather').innerText = "Failed to retrieve current weather.";
                    }
                })
                .catch(() => {
                    document.getElementById('current-weather').innerText = "Failed to retrieve current weather.";
                });

            // Fetch 5-day forecast
            fetch(forecastWeatherUrl)
                .then(response => response.json())
                .then(data => {
                    if (data && data.list) {
                        let forecastHtml = '';
                        data.list.forEach((forecast, index) => {
                            if (index % 8 === 0) { // Display one forecast per day
                                const date = new Date(forecast.dt_txt).toLocaleDateString();
                                const description = forecast.weather[0].description;
                                const temp = forecast.main.temp;
                                forecastHtml += `<p>${date}: ${description}, Temp: ${temp}°C</p>`;
                            }
                        });
                        document.getElementById('forecast').innerHTML = forecastHtml;
                    } else {
                        document.getElementById('forecast').innerText = "Failed to retrieve forecast.";
                    }
                })
                .catch(() => {
                    document.getElementById('forecast').innerText = "Failed to retrieve forecast.";
                });
        }

        function changeBackground(weatherCondition) {
            let bgColor;
            switch (weatherCondition.toLowerCase()) {
                case 'clear':
                    bgColor = '#87CEEB'; // Clear sky
                    break;
                case 'clouds':
                    bgColor = '#B0C4DE'; // Cloudy
                    break;
                case 'rain':
                case 'drizzle':
                    bgColor = '#1E90FF'; // Rainy
                    break;
                case 'thunderstorm':
                    bgColor = '#483D8B'; // Thunderstorm
                    break;
                case 'snow':
                    bgColor = '#FFFFFF'; // Snowy
                    break;
                default:
                    bgColor = '#708090'; // Default weather
                    break;
            }
            document.body.style.backgroundColor = bgColor;
        }

        // Initialize the app
        getGeoLocation();
    </script>
</body>
</html>

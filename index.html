<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather and Location App</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4ff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            background-color: white;
            width: 100%;
            max-width: 600px;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            color: #333;
        }

        .location, .weather-info, .forecast-info {
            margin-bottom: 20px;
        }

        .location-info {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .current-weather {
            font-size: 1.8rem;
            color: #fff;
            padding: 10px;
            border-radius: 8px;
        }

        .weather-status {
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .forecast {
            display: flex;
            justify-content: space-between;
        }

        .forecast-item {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            width: 30%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .forecast-item h3 {
            font-size: 1rem;
        }

        .forecast-item p {
            margin: 5px 0;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Weather and Location App</h1>
        <div class="location">
            <h2>Your Location</h2>
            <p id="location-info">Fetching location...</p>
        </div>

        <div class="weather-info">
            <h2>Current Weather</h2>
            <div id="current-weather" class="current-weather">Loading weather...</div>
        </div>

        <div class="forecast-info">
            <h2>5-Day Forecast</h2>
            <div id="forecast" class="forecast"></div>
        </div>
    </div>

    <script>
        const weatherApiKey = '74037a84a785450abf9190335241409';
        const weatherApiUrl = 'https://api.openweathermap.org/data/2.5/';
        const nominatimApiUrl = 'https://nominatim.openstreetmap.org/reverse';
        let lat, lon;

        function getGeoLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    (position) => {
                        lat = position.coords.latitude;
                        lon = position.coords.longitude;
                        document.getElementById('location-info').innerText = `Coordinates: Latitude ${lat}, Longitude ${lon}`;
                        fetchVillageName(lat, lon);
                        fetchWeatherData(lat, lon);
                    },
                    (error) => {
                        document.getElementById('location-info').innerText = "Unable to fetch location.";
                        console.error("Error fetching geolocation:", error);
                    }
                );
            } else {
                document.getElementById('location-info').innerText = "Geolocation not supported by your browser.";
            }
        }

        function fetchVillageName(lat, lon) {
            const reverseGeocodeUrl = `${nominatimApiUrl}?lat=${lat}&lon=${lon}&format=json&accept-language=en`;

            fetch(reverseGeocodeUrl)
                .then(response => response.json())
                .then(data => {
                    const village = data.display_name || 'Unknown location';
                    document.getElementById('location-info').innerText = `You are at: ${village}`;
                })
                .catch(error => {
                    console.error("Error fetching village name:", error);
                    document.getElementById('location-info').innerText = "Failed to retrieve village name.";
                });
        }

        function fetchWeatherData(lat, lon) {
            const currentWeatherUrl = `${weatherApiUrl}weather?lat=${lat}&lon=${lon}&appid=${weatherApiKey}&units=metric`;
            const forecastWeatherUrl = `${weatherApiUrl}forecast?lat=${lat}&lon=${lon}&appid=${weatherApiKey}&units=metric`;

            fetch(currentWeatherUrl)
                .then(response => response.json())
                .then(data => {
                    const temperature = data.main.temp;
                    const description = data.weather[0].description;
                    const condition = data.weather[0].main;
                    const weatherDiv = document.getElementById('current-weather');
                    weatherDiv.innerHTML = `Temperature: ${temperature}°C<br>Status: ${description}`;

                    // Change background color based on condition
                    changeBackgroundColor(condition);
                })
                .catch(error => {
                    console.error("Error fetching current weather:", error);
                    document.getElementById('current-weather').innerText = "Failed to retrieve current weather.";
                });

            fetch(forecastWeatherUrl)
                .then(response => response.json())
                .then(data => {
                    const forecastDiv = document.getElementById('forecast');
                    forecastDiv.innerHTML = ''; // Clear old forecast

                    data.list.slice(0, 5).forEach(forecast => {
                        const date = new Date(forecast.dt_txt).toLocaleDateString();
                        const temp = forecast.main.temp;
                        const weather = forecast.weather[0].description;

                        const forecastItem = `
                            <div class="forecast-item">
                                <h3>${date}</h3>
                                <p>Temp: ${temp}°C</p>
                                <p>${weather}</p>
                            </div>
                        `;
                        forecastDiv.innerHTML += forecastItem;
                    });
                })
                .catch(error => {
                    console.error("Error fetching weather forecast:", error);
                    document.getElementById('forecast').innerText = "Failed to retrieve weather forecast.";
                });
        }

        function changeBackgroundColor(condition) {
            let bgColor;
            switch (condition.toLowerCase()) {
                case 'clear':
                    bgColor = 'linear-gradient(to bottom, #4facfe, #00f2fe)';
                    break;
                case 'clouds':
                    bgColor = 'linear-gradient(to bottom, #d7d2cc, #304352)';
                    break;
                case 'rain':
                    bgColor = 'linear-gradient(to bottom, #00c6ff, #0072ff)';
                    break;
                case 'snow':
                    bgColor = 'linear-gradient(to bottom, #e6dada, #274046)';
                    break;
                case 'thunderstorm':
                    bgColor = 'linear-gradient(to bottom, #616161, #9bc5c3)';
                    break;
                default:
                    bgColor = 'linear-gradient(to bottom, #89f7fe, #66a6ff)';
            }
            document.body.style.background = bgColor;
        }

        // Trigger geolocation fetch on load
        window.onload = getGeoLocation;
    </script>

</body>
</html>

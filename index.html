
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fun Learning ‚Äî Speak & Spell</title>
  <style>
    :root{
      --bg:#f7fbff;--ink:#1f2937;--brand:#ff6b35;--ok:#16a34a;--bad:#ef4444;--chip:#87cefa;--chip-sel:#ffd700;--panel:#fff7c8;--accent:#6c8cff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,"Segoe UI",Verdana,sans-serif;overflow:hidden}

    /* --- 1 Screen, No Scrolling Layout --- */
    .wrap{display:grid;grid-template-rows:auto 1fr auto;grid-template-columns:1fr;height:100vh;max-height:100vh}

    header{background:linear-gradient(90deg,#fff, #ffe6d8);box-shadow:0 2px 12px rgba(0,0,0,.08)}
    .top{display:grid;grid-template-columns:1fr auto 1fr;gap:8px;align-items:center;max-width:1100px;margin:0 auto;padding:10px 14px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand h1{font-size:1.2rem;color:var(--brand);margin:0}
    .stats{justify-self:end;display:flex;gap:8px;flex-wrap:wrap}
    .pill{background:#fff;border:2px solid #f3f4f6;border-radius:999px;padding:6px 10px;display:inline-flex;gap:6px;align-items:center}
    .star{font-size:1.5rem}

    .meter{height:10px;background:#fff;border-radius:999px;overflow:hidden;border:2px solid #ffd6a8}
    .meter>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#ffb703,#ffd166);transition:width .35s}

    /* --- Middle Play Zone (no scroll) --- */
    main{max-width:1100px;margin:0 auto;padding:10px;height:100%;display:grid;grid-template-rows:1fr auto;gap:8px}

    .board{display:grid;grid-template-columns:1.1fr 1.4fr 1fr;gap:10px;height:100%}
    .card{background:var(--panel);border-radius:16px;box-shadow:0 10px 20px rgba(0,0,0,.12);padding:10px;display:flex;flex-direction:column}
    h2{margin:0 0 6px;color:#ff4500;font-size:1rem}

    .picture{flex:1;display:flex;align-items:center;justify-content:center;border:3px dashed #ff69b4;border-radius:14px;background:#fff;font-size:5.5rem}
    .hint{margin-top:6px;font-size:.95rem;color:#555;min-height:1.2em}

    .drop{flex:1;border:3px dashed #ff69b4;border-radius:14px;background:#fff;display:flex;align-items:center;justify-content:center;gap:8px;flex-wrap:wrap;font-size:2.2rem}
    .choices{flex:1;background:#fff;border-radius:14px;display:flex;flex-wrap:wrap;gap:8px;align-content:flex-start;justify-content:center;padding:8px}

    .chip{display:inline-flex;align-items:center;justify-content:center;background:var(--chip);padding:10px 14px;border-radius:14px;font-size:2.2rem;cursor:pointer;user-select:none;transition:transform .15s, background .15s}
    .chip:active{transform:scale(.97)}
    .chip.selected{background:var(--chip-sel);transform:scale(1.1)}

    .drop.ok{animation:pop .5s;box-shadow:0 0 0 4px rgba(22,163,74,.18) inset}
    .drop.bad{animation:shake .35s;box-shadow:0 0 0 4px rgba(239,68,68,.18) inset}
    @keyframes pop{0%{transform:scale(1)}50%{transform:scale(1.02)}100%{transform:scale(1)}}
    @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}

    /* --- Bottom Controls --- */
    .controls{display:flex;gap:8px;justify-content:center}
    .btn{appearance:none;border:0;border-radius:14px;padding:12px 16px;font-size:1.05rem;cursor:pointer;display:inline-flex;align-items:center;gap:8px;color:#fff;background:var(--accent);box-shadow:0 8px 16px rgba(108,140,255,.32)}
    .btn.ghost{background:#fff;color:#111;border:2px solid #e5e7eb;box-shadow:0 8px 16px rgba(0,0,0,.08)}
    .btn:active{transform:scale(.98)}

    /* Canvas for confetti */
    canvas#confetti{position:fixed;inset:0;pointer-events:none;z-index:999}

    /* Small screens: keep single screen feel */
    @media (max-width:860px){
      .board{grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr}
      .right{grid-column:1/-1}
      .picture{font-size:4rem}
      .chip{font-size:1.8rem}
    }
    @media (max-height:640px){
      .picture{font-size:4rem}
      .chip{font-size:1.8rem}
    }
  </style>
</head>
<body>
  <canvas id="confetti"></canvas>
  <div class="wrap">
    <header>
      <div class="top">
        <div class="brand">
          <span style="font-size:1.6rem">üåà</span>
          <h1>Fun Learning ‚Äî Speak & Spell</h1>
        </div>
        <div class="meter" aria-label="Level progress"><i id="bar"></i></div>
        <div class="stats">
          <span class="pill"><span class="star">‚≠ê</span> <b id="stars">0</b></span>
          <span class="pill">‚úÖ <b id="correct">0</b></span>
          <button class="btn" id="micBtn" title="Tap to speak the word">üéôÔ∏è Speak</button>
          <button class="btn ghost" id="muteBtn" title="Voice on/off">üîä Voice On</button>
        </div>
      </div>
    </header>

    <main>
      <div class="board">
        <section class="card left">
          <h2>üì∏ Picture Clue</h2>
          <div class="picture" id="picture">üò∫</div>
          <div class="hint" id="hint"></div>
        </section>

        <section class="card center">
          <h2>üî§ Build the Word</h2>
          <div class="drop" id="drop" aria-label="Drop letters here"></div>
          <div class="hint" id="feedback" aria-live="polite"></div>
        </section>

        <section class="card right">
          <h2>üî° Your Letters</h2>
          <div class="choices" id="choices"></div>
        </section>
      </div>

      <div class="controls">
        <button class="btn ghost" id="repeatBtn">üîÅ Repeat</button>
        <button class="btn ghost" id="hintBtn">üí° Hint</button>
        <button class="btn" id="checkBtn">‚úÖ Check</button>
        <button class="btn" id="nextBtn">‚è≠Ô∏è Next</button>
      </div>
    </main>

    <footer style="text-align:center;padding:6px 10px;font-size:.9rem;color:#6b7280">
      Massive encouragement mode: ON ‚Äî you‚Äôve got this, superstar! üåü
    </footer>
  </div>

  <script>
    /*****************
     * Data & State  *
     *****************/
    const synth = window.speechSynthesis;
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;

    const WORDS = [
      { word:'cat', hint:'A furry pet that says meow', pic:'üê±' },
      { word:'dog', hint:'A loyal friend that barks', pic:'üê∂' },
      { word:'sun', hint:'Shines bright in the sky', pic:'‚òÄÔ∏è' },
      { word:'bed', hint:'Where you sleep', pic:'üõèÔ∏è' },
      { word:'fish', hint:'Swims in water', pic:'üêü' },
      { word:'book', hint:'Full of stories', pic:'üìñ' },
      { word:'tree', hint:'Tall with leaves', pic:'üå≥' },
      { word:'ball', hint:'You can throw it', pic:'‚öΩ' },
      { word:'moon', hint:'Shines at night', pic:'üåô' },
      { word:'star', hint:'Twinkles at night', pic:'‚≠ê' }
    ];

    const praise = [
      'Brilliant!','Super star!','You are amazing!','High five!','Legend!','Fantastic job!','Wow, you rock!','Gold medal energy!','Mega brain power!','Happy dance time!'
    ];

    const state = { mute:false, stars:0, correct:0, tries:0, idx:0, current:null };

    function save(){ try{ localStorage.setItem('speakspell', JSON.stringify({stars:state.stars, correct:state.correct})); }catch{} }
    function load(){ try{ const raw=JSON.parse(localStorage.getItem('speakspell')||'{}'); state.stars=raw.stars||0; state.correct=raw.correct||0; }catch{} }

    /*****************
     * Helpers       *
     *****************/
    const byId = (id)=>document.getElementById(id);
    const removeEmojis=(t)=>t&&t.replace(/[\p{Extended_Pictographic}\u{FE0F}]/gu,'');

    function speak(text, rate=.95, pitch=1.1){
      if(state.mute) return; if(!('speechSynthesis' in window)) return;
      const u=new SpeechSynthesisUtterance(removeEmojis(String(text)));
      u.rate=rate; u.pitch=pitch; synth.cancel(); synth.speak(u);
    }

    function cheer(){
      if(state.mute) return;
      try{const ac=new (window.AudioContext||window.webkitAudioContext)(); const o=ac.createOscillator(); const g=ac.createGain(); o.type='triangle'; o.frequency.value=660; g.gain.value=0.001; g.gain.exponentialRampToValueAtTime(0.2, ac.currentTime+0.01); o.connect(g).connect(ac.destination); o.start(); o.frequency.exponentialRampToValueAtTime(1320, ac.currentTime+.2); g.gain.exponentialRampToValueAtTime(0.0001, ac.currentTime+.35); o.stop(ac.currentTime+.36);}catch{}
    }

    function confetti(ms=1200){
      const canvas=byId('confetti'); const ctx=canvas.getContext('2d');
      const dpr=Math.max(1,devicePixelRatio||1); canvas.width=innerWidth*dpr; canvas.height=innerHeight*dpr; ctx.scale(dpr,dpr);
      const N=240; const a=[]; for(let i=0;i<N;i++){ a.push({x:Math.random()*innerWidth,y:-Math.random()*innerHeight,r:Math.random()*7+3,c:`hsl(${Math.random()*360},100%,50%)`,vy:2+Math.random()*4,vx:Math.sin(i)*2}); }
      let t=0, stop=ms/16; (function draw(){ ctx.clearRect(0,0,innerWidth,innerHeight); for(const p of a){ ctx.fillStyle=p.c; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); p.y+=p.vy; p.x+=p.vx; if(p.y>innerHeight) p.y=-p.r; } if(t++<stop) requestAnimationFrame(draw); else ctx.clearRect(0,0,innerWidth,innerHeight); })();
    }

    function shuffle(arr){ return arr.slice().sort(()=>Math.random()-.5); }

    /*****************
     * Game Logic    *
     *****************/
    function newRound(){
      const item = WORDS[state.idx % WORDS.length];
      state.current=item; byId('picture').textContent=item.pic; byId('hint').textContent=item.hint;
      const letters = shuffle(item.word.split(''));
      const choices = byId('choices'); const drop = byId('drop');
      choices.innerHTML=''; drop.innerHTML=''; drop.classList.remove('ok','bad');

      letters.forEach(ch=>{ const d=document.createElement('div'); d.className='chip'; d.textContent=ch; d.onclick=()=>{ d.classList.add('selected'); setTimeout(()=>d.classList.remove('selected'),220); drop.appendChild(d); speak(ch); }; choices.appendChild(d); });
      drop.onclick=(ev)=>{ if(ev.target.classList.contains('chip') && ev.target.parentNode===drop){ choices.appendChild(ev.target); speak('remove'); } };

      updateHud();
      setTimeout(()=>speak(`Spell ${item.word}. ${item.hint}`), 300);
    }

    function formedWord(){ return [...byId('drop').children].map(n=>n.textContent).join(''); }

    function check(){
      const guess = formedWord();
      const correct = state.current.word;
      const ok = guess.toLowerCase()===correct.toLowerCase();
      state.tries++; if(ok){ state.correct++; state.stars++; praiseUser(); confetti(); cheer(); state.idx++; newRound(); } else { nudgeUser(guess); }
      updateHud(); save();
    }

    function hint(){
      // Move next correct letter into place (costs 1 star if available)
      if(state.stars<=0){ speak('Earn a star first to get a hint. You can do it!'); flash(byId('feedback'), 'Keep trying!'); return; }
      state.stars--; updateHud();
      const drop=byId('drop'); const choices=byId('choices');
      const correct=state.current.word; const built=formedWord();
      if(built.length<correct.length){ const next=correct[built.length]; const chip=[...choices.children].find(el=>el.textContent.toLowerCase()===next.toLowerCase()); if(chip){ drop.appendChild(chip); chip.classList.add('selected'); setTimeout(()=>chip.classList.remove('selected'),200); speak(`${next}`);} }
      save();
    }

    /*****************
     * Massive Encouragement
     *****************/
    function flash(el, text){ el.textContent=text; setTimeout(()=>{ el.textContent=''; }, 1500); }
    function praiseUser(){
      const msg = shuffle(praise)[0];
      byId('drop').classList.add('ok');
      flash(byId('feedback'), `${msg} ‚úÖ`);
      speak(`${msg}! You spelled ${state.current.word}!`);
      setTimeout(()=>byId('drop').classList.remove('ok'), 500);
    }
    function nudgeUser(guess){
      byId('drop').classList.add('bad');
      const near = guess? `That looked like ${guess}. `: '';
      speak(`${near}Almost there! Try again, champion!`);
      flash(byId('feedback'), 'So close! Try again üí™');
      setTimeout(()=>byId('drop').classList.remove('bad'), 350);
    }

    function updateHud(){
      byId('stars').textContent = state.stars;
      byId('correct').textContent = state.correct;
      const pct = Math.min(100, (state.correct%5)*20); // simple looped bar
      byId('bar').style.width = pct+"%";
    }

    /*****************
     * Voice Input   *
     *****************/
    let recog=null, listening=false;
    function ensureRecog(){
      if(!SR) return null; if(recog) return recog;
      recog = new SR(); recog.lang='en-US'; recog.interimResults=false; recog.maxAlternatives=3;
      recog.onresult = (ev)=>{
        const results=[...ev.results[0]].map(r=>r.transcript.toLowerCase().trim());
        const target = state.current.word.toLowerCase();
        const ok = results.some(t=> t===target || t.replace(/[^a-z]/g,'')===target);
        if(ok){ state.correct++; state.stars++; praiseUser(); confetti(); cheer(); state.idx++; newRound(); }
        else{ speak(`I heard ${results[0]}. Let's try again together: ${state.current.word}.`); nudgeUser(results[0]); }
        listening=false; byId('micBtn').textContent='üéôÔ∏è Speak';
        updateHud(); save();
      };
      recog.onerror = ()=>{ listening=false; byId('micBtn').textContent='üéôÔ∏è Speak'; };
      recog.onend=()=>{ listening=false; byId('micBtn').textContent='üéôÔ∏è Speak'; };
      return recog;
    }

    function toggleMic(){
      const r = ensureRecog();
      if(!r){ alert('Speech recognition is not supported on this device/browser.'); return; }
      if(listening){ r.stop(); listening=false; byId('micBtn').textContent='üéôÔ∏è Speak'; return; }
      listening=true; byId('micBtn').textContent='üõë Stop'; r.start(); speak(`Say the word now`);
    }

    /*****************
     * Events        *
     *****************/
    byId('checkBtn').onclick=check;
    byId('hintBtn').onclick=hint;
    byId('nextBtn').onclick=()=>{ state.idx++; newRound(); };
    byId('repeatBtn').onclick=()=>{ speak(`Spell ${state.current.word}. ${state.current.hint}`); };
    byId('micBtn').onclick=toggleMic;
    byId('muteBtn').onclick=()=>{ state.mute=!state.mute; byId('muteBtn').textContent = state.mute? 'üîá Voice Off' : 'üîä Voice On'; };

    // Init
    load(); newRound();
  </script>
</body>
</html>
